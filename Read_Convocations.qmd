---
title: "Read_Convocations"
author: "Alan Jackson"
format: html
editor: visual
---

## Read convocation coordinate file


```{r setup}

library(tidyverse)

path <- "/home/ajackson/Dropbox/Rprojects/TexasDioceseCreationCare/Data/"

```

##  Read the data

```{r read data in (and save it)}

foo <- sf::st_read(paste0(path, "The Episcopal Diocese of Texas.kml"))

Convocations <- foo %>% 
  filter(stringr::str_detect(Name, "Convocation|Region")) %>% 
  mutate(ConvoColor=row_number())

#   Add convocation to parish

Parishes <- foo %>% 
  mutate(Convocation=NA)

for (i in 1:nrow(foo)){
  if (stringr::str_detect(foo[i,]$Name, "Convocation|Region")){  
    Convo <- foo[i,]$Name
  }
  print(Convo)
  Parishes[i,]$Convocation <- Convo 
}

Parishes <- Parishes %>% 
  filter(!stringr::str_detect(Name, "Convocation|Region")) %>% 
  mutate(description=stringr::str_replace(description, "http://trinitywoodlands.org/", 
                                          "3901 South Panther Creek Drive<br>The Woodlands, TX 77381<br>281-367-8113<br>trinitywoodlands.org (https://www.trinitywoodlands.org/)"))
  
saveRDS(Convocations, paste0(path, "Convocations.rds"))
saveRDS(Parishes, paste0(path, "Parishes.rds"))

```


##  Plot the data

```{r plot}

#   Plot

tmap::tmap_options(basemaps="OpenStreetMap")

tmap::tmap_mode("view") # set mode to interactive plots


tmap::tm_shape(Convocations) + 
    #tmap::tm_sf(col="ConvoColor", alpha=0.3) +
  tmap::tm_fill(col = "ConvoColor", title = "Convocation", alpha=0.3, style="cat")+
  tmap::tm_borders() +
  tmap::tm_shape(Parishes) + 
    tmap::tm_dots()


```






